{{ define "main" }}
  {{ $disableImageOptimization := .Site.Params.disableImageOptimization | default false }}
  <section class="flex flex-col items-center justify-center text-center px-4 py-8">
    <header class="relative flex flex-col items-center mb-6">
      {{ with .Site.Params.Author.image }}
        {{ $authorImage := "" }}
        {{ if or (strings.HasPrefix . "http:") (strings.HasPrefix . "https:") }}
          {{ $authorImage = resources.GetRemote . }}
        {{ else }}
          {{ $authorImage = resources.Get . }}
        {{ end }}
        {{ if $authorImage }}
          {{ $final := $authorImage }}
          {{ $squareImage := $authorImage }}
          {{ if not (or $disableImageOptimization (eq $authorImage.MediaType.SubType "svg")) }}
            {{ $final = $authorImage.Fill (print "288x288 q" ( $.Site.Params.Author.imagequality | default "96" )) }}
            {{ $shortSide := int (math.Min $authorImage.Width $authorImage.Height) }}
            {{ $squareImage = $authorImage.Crop (printf "%dx%d" $shortSide $shortSide ) }}
          {{ end }}
          <img
            class="mb-3 h-36 w-36 rounded-full"
            width="144"
            height="144"
            alt="{{ $.Site.Params.Author.name | default `Author` }}"
            src="{{ $final.RelPermalink }}"
            data-zoom-src="{{ $squareImage.RelPermalink }}">
        {{ else }}
          <img
            class="mb-3 h-36 w-36 rounded-full"
            width="144"
            height="144"
            alt="{{ $.Site.Params.Author.name | default `Author` }}"
            src="{{ . | relURL }}">
        {{ end }}
      {{ end }}

      <h1 class="text-4xl font-extrabold text-neutral-900 dark:text-neutral-100">
        {{ .Site.Params.Author.name | default .Site.Title }}
      </h1>
      {{ with .Site.Params.Author.headline }}
        <h2 class="mt-2 text-xl text-neutral-500 dark:text-neutral-400">
          {{ . | markdownify }}
        </h2>
      {{ end }}
      <div class="mt-3 text-2xl">
        {{ partialCached "author-links.html" . }}
      </div>
    </header>

    <section class="prose dark:prose-invert max-w-2xl">
      {{ if .Content }}
        {{ .Content }}
      {{ else if .Site.Params.Author.bio }}
        {{ .Site.Params.Author.bio | markdownify }}
      {{ end }}
    </section>

    <section class="mt-8 w-full max-w-7xl px-4">
      <h2 class="text-2xl font-bold text-neutral-900 dark:text-neutral-100 mb-6">Visited Countries</h2>
      <div id="visited-map" class="visited-map"></div>
    </section>
  </section>

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/css/jsvectormap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/js/jsvectormap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/maps/world-merc.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var el = document.getElementById("visited-map");
      if (!el) return;
      new jsVectorMap({
        selector: "#visited-map",
        map: "world_merc",
        zoomButtons: true,
        zoomOnScroll: true,
        zoomMax: 12,
        zoomMin: 1,
        zoomAnimate: true,
        regionStyle: {
          initial: { 
            fill: "#2f3136",
            stroke: "#1a1d21",
            strokeWidth: 0.5
          },
          hover: {
            fill: "#4a5568",
            cursor: "pointer"
          },
          selected: { 
            fill: "#38bdf8",
            stroke: "#0ea5e9",
            strokeWidth: 1
          }
        },
        selectedRegions: ["VN", "KR"],
        labels: {
          regions: { 
            render: function (code) { 
              return ""; 
            } 
          }
        }
      });
    });
  </script>
{{ end }}