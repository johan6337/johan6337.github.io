{{ define "main" }}
  {{ $disableImageOptimization := .Site.Params.disableImageOptimization | default false }}
  <section class="flex flex-col items-center justify-center text-center px-4 py-8">
    
    <header class="relative flex flex-col items-center mb-6">
      {{ with .Site.Params.Author.image }}
        {{ $authorImage := "" }}
        {{ if or (strings.HasPrefix . "http:") (strings.HasPrefix . "https:") }}
          {{ $authorImage = resources.GetRemote . }}
        {{ else }}
          {{ $authorImage = resources.Get . }}
        {{ end }}
        {{ if $authorImage }}
          {{ $final := $authorImage }}
          {{ $squareImage := $authorImage }}
          {{ if not (or $disableImageOptimization (eq $authorImage.MediaType.SubType "svg")) }}
            {{ $final = $authorImage.Fill (print "288x288 q" ( $.Site.Params.Author.imagequality | default "96" )) }}
            {{ $shortSide := int (math.Min $authorImage.Width $authorImage.Height) }}
            {{ $squareImage = $authorImage.Crop (printf "%dx%d" $shortSide $shortSide ) }}
          {{ end }}
          <img
            class="mb-3 h-36 w-36 rounded-full"
            width="144"
            height="144"
            alt="{{ $.Site.Params.Author.name | default `Author` }}"
            src="{{ $final.RelPermalink }}"
            data-zoom-src="{{ $squareImage.RelPermalink }}">
        {{ else }}
          <img
            class="mb-3 h-36 w-36 rounded-full"
            width="144"
            height="144"
            alt="{{ $.Site.Params.Author.name | default `Author` }}"
            src="{{ . | relURL }}">
        {{ end }}
      {{ end }}

      <h1 class="text-4xl font-extrabold text-neutral-900 dark:text-neutral-100">
        {{ .Site.Params.Author.name | default .Site.Title }}
      </h1>
      {{ with .Site.Params.Author.headline }}
        <h2 class="mt-2 text-xl text-neutral-500 dark:text-neutral-400">
          {{ . | markdownify }}
        </h2>
      {{ end }}
      <div class="mt-3 text-2xl">
        {{ partialCached "author-links.html" . }}
      </div>
    </header>

    <section class="prose dark:prose-invert max-w-2xl">
      {{ if .Content }}
        {{ .Content }}
      {{ else if .Site.Params.Author.bio }}
        {{ .Site.Params.Author.bio | markdownify }}
      {{ end }}
    </section>

    <section class="mt-8 w-full max-w-7xl px-4">
      <h2 class="text-2xl font-bold text-neutral-900 dark:text-neutral-100 mb-6">Visited Countries</h2>
      <div id="visited-map" class="visited-map" style="height: 500px;"></div>
    </section>

    <section class="mt-12 w-full max-w-7xl px-4">
      <h2 class="text-2xl font-bold text-neutral-900 dark:text-neutral-100 mb-6">Vietnam Check-in</h2>
      <div id="vietnam-map" class="visited-map" style="height: 600px;"></div>
    </section>

  </section>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/css/jsvectormap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/js/jsvectormap.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/maps/world-merc.js"></script>
  
  <script src="/js/maps/vietnam.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      
      // --- CẤU HÌNH MAP THẾ GIỚI ---
      var worldEl = document.getElementById("visited-map");
      if (worldEl) {
        new jsVectorMap({
          selector: "#visited-map",
          map: "world_merc",
          zoomButtons: true,
          zoomOnScroll: false,
          zoomMax: 12,
          zoomMin: 1,
          regionStyle: {
            initial: { fill: "#2f3136", stroke: "#1a1d21", strokeWidth: 0.5 },
            hover: { fill: "#4a5568", cursor: "pointer" },
            selected: { fill: "#e11d48", stroke: "#ffffff", strokeWidth: 1 }
          },
          selectedRegions: ["VN", "KR"], // Mã quốc gia ISO 2 chữ cái
        });
      }

      // --- CẤU HÌNH MAP VIỆT NAM ---
      var vnEl = document.getElementById("vietnam-map");
      if (vnEl) {
        new jsVectorMap({
          selector: "#vietnam-map",
          map: "vietnam", // Tên map định nghĩa trong file vietnam.js
          zoomButtons: true,
          zoomOnScroll: false,
          regionStyle: {
            initial: { fill: "#2f3136", stroke: "#1a1d21", strokeWidth: 0.5 },
            hover: { fill: "#4a5568", cursor: "pointer" },
            selected: { fill: "#e11d48", stroke: "#ffffff", strokeWidth: 1 } // Màu đỏ hồng cho nổi bật
          },
          // Danh sách ID các tỉnh đã đi (theo file JS bạn cung cấp)
          // "24": Hà Nội, "31": TP.HCM, "15": Đà Nẵng, "37": Lạng Sơn...
          selectedRegions: ["24", "31", "15", "41", "10", "25","8","2","18","38"],
          
          // Tooltip hiển thị tên tỉnh
          onRegionTooltipShow(event, tooltip, code) {
             // Thư viện tự lấy tên từ file js, không cần config thêm
          }
        });
      }

    });
  </script>
{{ end }}